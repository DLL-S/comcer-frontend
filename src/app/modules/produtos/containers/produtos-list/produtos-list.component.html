<section class="container-filtro">
   <mat-form-field appearance="standard" class="filtro">
      <mat-label>Filtro</mat-label>
      <input matInput (keyup)="filtrar($event)" placeholder="Ex. Pizza" #input>
      <mat-icon matSuffix class="icone-filtro">filter_alt</mat-icon>
   </mat-form-field>

   <button mat-mini-fab color="primary" aria-label="Adicionar" matTooltip="Adicionar produto" matTooltipPosition="below"
      (click)="abrirDialogoDeEdicao()">
      <mat-icon>add</mat-icon>
   </button>
</section>

<div class="main-container mat-elevation-z3">

   <div class="loading-shade" *ngIf="carregando">
      <mat-spinner></mat-spinner>
   </div>

   <table mat-table matSort [dataSource]="produtos" matSortDisableClear matSortDirection="asc" multiTemplateDataRows>

      <!-- Coluna Foto -->
      <ng-container matColumnDef="foto">
         <mat-header-cell *matHeaderCellDef> Foto </mat-header-cell>
         <mat-cell mat-cell *matCellDef="let produto">
            <img src='data:image/png;base64,{{produto.foto}}' />
         </mat-cell>
      </ng-container>

      <!-- Coluna Nome -->
      <ng-container matColumnDef="nome">
         <mat-header-cell mat-sort-header *matHeaderCellDef> Nome </mat-header-cell>
         <mat-cell mat-cell *matCellDef="let produto"> {{produto.id + " - " + produto.nome}} </mat-cell>
      </ng-container>

      <!-- Coluna Preço -->
      <ng-container matColumnDef="preco">
         <mat-header-cell *matHeaderCellDef> Preço </mat-header-cell>
         <mat-cell mat-cell *matCellDef="let produto"> {{produto.preco | currency: 'BRL'}} </mat-cell>
      </ng-container>

      <!-- Coluna Ações -->
      <ng-container matColumnDef="acoes">
         <mat-header-cell *matHeaderCellDef> Ações </mat-header-cell>
         <mat-cell mat-cell *matCellDef="let produto">
            <button class="botao-acao" mat-mini-fab color="primary" aria-label="Editar" matTooltip="Editar produto"
               matTooltipPosition="before" (click)="abrirDialogoDeEdicao(produto)">
               <mat-icon>edit</mat-icon>
            </button>
         </mat-cell>
      </ng-container>

      <!-- Descrição exibida ao expandir a linha -->
      <ng-container matColumnDef="expandedDetail">
         <td mat-cell *matCellDef="let element" [attr.colspan]="colunasVisiveis.length">
            <div class="detalhes-produto" [@detailExpand]="element == produtoClicado ? 'expanded' : 'collapsed'">
               <div class="descricao-produto">
                  {{element.descricao}}
               </div>
            </div>
         </td>
      </ng-container>

      <mat-header-row *matHeaderRowDef="colunasVisiveis"></mat-header-row>
      <mat-row matRipple *matRowDef="let row; columns: colunasVisiveis;" class="example-element-row"
         [class.example-expanded-row]="produtoClicado === row" (click)="toggleRowExpanded(row)"
         (dblclick)="abrirDialogoDeEdicao(row)">
      </mat-row>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="linha-detalhes-produto"></tr>
   </table>

   <mat-paginator [pageSizeOptions]="[10, 15, 25, 50]" [length]="quantidadeTotal" showFirstLastButtons
      aria-label="Paginação de produtos">
   </mat-paginator>

</div>

<button mat-fab class="botao-recarregar" color="primary" aria-label="Recarregar dados" (click)="atualizarDados(true)">
   <mat-icon>refresh</mat-icon>
</button>
